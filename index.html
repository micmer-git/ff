<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>futuro fortissimo â€“ explorer</title>

<!-- font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#fafaf7;--fg:#232323;--accent:#38bdf8;--gutterW:56px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:"PT Serif",serif;color:var(--fg);background:var(--bg);}

header{position:fixed;top:0;left:0;right:0;z-index:30;background:var(--bg);padding:.35rem 6vw .25rem calc(6vw+var(--gutterW));display:flex;align-items:center;gap:.8rem}
header img{height:34px}
header h1{font-size:1.55rem;font-style:italic;font-weight:700}

#topBar{margin-top:.35rem;display:flex;align-items:center;gap:.7rem;padding:0 6vw 0 calc(6vw+var(--gutterW));}
#topBar input{flex:1;border:none;border-bottom:2px solid var(--fg);background:transparent;font-size:1.1rem;outline:none;padding:.2rem .1rem}
.pill{border:2px solid var(--fg);padding:.15rem .9rem;border-radius:9999px;cursor:pointer;font-size:1.1rem}
.pill.active{background:var(--accent);border-color:var(--accent);color:#fff}

#gutter{position:fixed;right:0;top:0;bottom:0;width:var(--gutterW);display:flex;flex-direction:column;align-items:center;
        padding-top:4.7rem;gap:.55rem;overflow-y:auto}
.tag{background:#fff;border:1px solid #d1d5db;border-radius:9999px;padding:.2rem .6rem;font-size:1.15rem;cursor:pointer}
.tag.active{background:var(--accent);border-color:var(--accent);color:#fff}

#canvas{height:100%;overflow-y:auto;scroll-snap-type:y mandatory;padding-top:6.8rem}
.page{scroll-snap-align:start;min-height:calc(100vh - 6.8rem);display:flex;align-items:center;justify-content:center;padding:0 6vw 4rem}
.box{background:#ffffff;border-radius:14px;box-shadow:0 4px 8px rgba(0,0,0,.06);max-width:680px;width:100%;
     max-height:68vh;overflow-y:auto;padding:2.4rem 2rem}
.box::-webkit-scrollbar{display:none}
.box h2{font-size:1.9rem;margin-bottom:1rem;font-weight:700}
.box h3{font-size:1.3rem;margin:.5rem 0 .3rem;font-weight:700}
.box p{line-height:1.58;margin-bottom:.9rem}
.box .src{font-size:.8rem;color:#666}
.click{cursor:pointer}

footer{position:fixed;bottom:0;left:0;right:0;padding:.55rem 6vw;background:var(--bg);display:flex;gap:.8rem;justify-content:center}
footer .cta{border:2px solid var(--fg);padding:.15rem 1.1rem;border-radius:9999px;font-size:1rem;cursor:pointer}
footer .cta:hover{background:var(--accent);border-color:var(--accent);color:#fff}
</style>
</head>

<body>
<header>
  <img src="logo.png" alt="logo futuro fortissimo">
  <h1>futuro&nbsp;fortissimo</h1>
</header>

<!-- search + main filters -->
<div id="topBar">
  <input id="searchInput" placeholder="cerca / searchâ€¦">
  <div id="pillBooks" class="pill">ðŸ“š</div>
  <div id="pillNotes" class="pill">ðŸŽ¶</div>
</div>

<!-- right gutter tag bar -->
<div id="gutter"></div>

<!-- vertical canvas -->
<div id="canvas"></div>

<!-- footer CTA -->
<footer>
  <div class="cta" onclick="window.open('https://www.paypal.com/paypalme/michelemerelli','_blank')">â˜• sostieni</div>
  <div class="cta" onclick="window.open('https://linktr.ee/micmer','_blank')">ðŸ‘¤ chi&nbsp;sono</div>
</footer>

<script>
/* -------- assets -------- */
const SRC={it:'newsletter_data.json',en:'newsletter_data_en.json'};
const NOTES_PATH='notes.json',BOOKS_PATH='books.json';
let LANG='it',PUBS,NOTES,BOOKS;

/* -------- state -------- */
const mainF=new Set();          // ðŸ“š ðŸŽ¶
const tagF =new Set();          // emoji temi
let q='';

/* helpers */
const $=s=>document.querySelector(s),
      tagList=['ðŸ’»','ðŸƒ','â¤ï¸','ðŸ’¸','âš½','ðŸ½','ðŸ§ ','ðŸ’Š','ðŸŽ¨','ðŸš•','ðŸ¥½','ðŸ‘¥','ðŸ’†'],
      rnd=a=>a.sort(()=>Math.random()-.5),
      hasTag=(tags)=>tagF.size?tags?.some(t=>tagF.has(t)):true,
      match=(t,s)=>t.toLowerCase().includes(s);

function mark(t){return t.replace(new RegExp(`(${q})`,'gi'),'<mark>$1</mark>');}

/* ---------- build gutter ---------- */
const gut=$('#gutter');
tagList.forEach(e=>{
  const d=document.createElement('div');
  d.textContent=e;d.className='tag';gut.appendChild(d);
  d.onclick=()=>{d.classList.toggle('active');tagF.has(e)?tagF.delete(e):tagF.add(e);render();}
});

/* ---------- top pills ---------- */
$('#pillBooks').onclick=e=>{toggleMain(e.currentTarget,'ðŸ“š');};
$('#pillNotes').onclick=e=>{toggleMain(e.currentTarget,'ðŸŽ¶');};
function toggleMain(el,emo){el.classList.toggle('active');mainF.has(emo)?mainF.delete(emo):mainF.add(emo);render();}

/* search */
$('#searchInput').oninput=e=>{q=e.target.value.toLowerCase();render();};

/* ---------- load JSON ---------- */
Promise.all([
  fetch(SRC[LANG]).then(r=>r.json()),
  fetch(NOTES_PATH).then(r=>r.json()),
  fetch(BOOKS_PATH).then(r=>r.json())
]).then(([d,n,b])=>{
  PUBS=rnd(d.publications);
  NOTES=rnd(n.notes);
  BOOKS=rnd(b);
  render();
});

/* ---------- render ---------- */
function render(){
  const C=$('#canvas');C.innerHTML='';
  let pages=[];

  if(q){ /* --- SEARCH --- */
    PUBS.forEach(p=>p.cards.filter(c=>!c.title.startsWith('ðŸ“–')).forEach(c=>{
      const txt=[p.title,c.title,...c.contentBlocks[0].content].join(' ');
      if(match(txt,q)&&hasTag(c.tags)) pages.push(pubPage(p,c,true));
    }));
    BOOKS.forEach(b=>{if(match(b.title,q)||match(b.text,q)) pages.push(bookPage(b,true));});
    NOTES.forEach(n=>{const txt=n.title+(n.description||'');if(match(txt,q)) pages.push(notePage(n,true));});
  }else{
    /* main filters */
    if(mainF.has('ðŸ“š') && !mainF.has('ðŸŽ¶')) BOOKS.forEach(b=>pages.push(bookPage(b,false)));
    else if(mainF.has('ðŸŽ¶') && !mainF.has('ðŸ“š')) NOTES.forEach(n=>pages.push(notePage(n,false)));
    else{
      const theme=tagF.size>0;
      PUBS.forEach(p=>{
        p.cards.filter(c=>!c.title.startsWith('ðŸ“–') && (!theme||c.tags?.some(t=>tagF.has(t))))
               .forEach(c=>pages.push(pubPage(p,c,false)));
      });
      if(!theme){BOOKS.forEach(b=>pages.push(bookPage(b,false)));NOTES.forEach(n=>pages.push(notePage(n,false))); }
    }
  }
  pages.forEach(p=>C.appendChild(p));
}

/* ---------- page builders ---------- */
function pubPage(pub,sub,hl){
  const s=document.createElement('section');s.className='page';
  const b=document.createElement('div');b.className='box click';
  b.innerHTML=`<h2>${hl?mark(pub.title):pub.title}</h2>
               <h3>${hl?mark(sub.title):sub.title}</h3>
               ${sub.contentBlocks[0].content.map(t=>`<p>${hl?mark(t):t}</p>`).join('')}`;
  b.onclick=()=>window.open(pub.substackLink,'_blank');s.appendChild(b);return s;
}
function bookPage(o,hl){
  const s=document.createElement('section');s.className='page';
  const b=document.createElement('div');b.className='box click';
  b.innerHTML=`<h2>${hl?mark(o.title):o.title}</h2>
               <p>${hl?mark(o.text):o.text}</p>
               <p class="src">${o.book} â€” ${o.author}</p>`;
  if(o.url) b.onclick=()=>window.open(o.url,'_blank');s.appendChild(b);return s;
}
function notePage(n,hl){
  const s=document.createElement('section');s.className='page';
  const b=document.createElement('div');b.className='box click';
  const host=n.url?new URL(n.url).hostname.replace(/^www\./,''):'';
  b.innerHTML=`<h2>${hl?mark(n.title):n.title}</h2>
               <p class="src">${host}</p>`;
  if(n.url) b.onclick=()=>window.open(n.url,'_blank');s.appendChild(b);return s;
}
</script>
</body>
</html>