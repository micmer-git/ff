<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>futuro fortissimo</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
<style>
:root{
  --theme:#ADD8E6;--question:#B3E5FC;--data:#81D4FA;--quote:#4FC3F7;--progress:#4CAF50
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:'Montserrat',sans-serif;background:#fff;color:#333;overflow:hidden}
.app-container{display:flex;flex-direction:column;height:100%}
.header{display:flex;align-items:center;background:var(--theme);padding:10px}
.logo{height:40px;margin-right:10px;cursor:pointer;flex-shrink:0}
.language-switch{background:0 0;border:none;font-size:24px;cursor:pointer;margin-left:10px;flex-shrink:0}
.buttons-container{display:flex;overflow-x:auto;flex-grow:1}
.buttons-container::-webkit-scrollbar{display:none}
.button{flex:0 0 auto;margin:0 5px;padding:8px 12px;background:#fff;border-radius:20px;font-size:14px;cursor:pointer;white-space:nowrap}
.progress-bar{height:5px;background:var(--progress);width:0;transition:width .5s ease-in-out;flex-shrink:0}
.cards-container{flex:1;overflow:hidden;position:relative}
.cards-wrapper{display:flex;height:100%;transition:transform .5s ease-in-out}
.card{flex:0 0 100%;height:100%;display:flex;flex-direction:column;background:#fff;border:2px solid transparent;border-radius:18px;overflow:hidden}
.card-content{flex:1;overflow-y:auto;padding:10px 20px 30px;max-width:450px;margin:0 auto}
.card-content::-webkit-scrollbar{width:0;background:transparent}
.section-title{margin:10px 0;font-size:20px;font-weight:bold;display:flex;align-items:center;justify-content:space-between}
.content-block{margin-bottom:15px;padding:10px;border-radius:10px;font-size:16px;font-weight:bold}
.questions{background:var(--question)}
.data{background:var(--data)}
.quotes{background:var(--quote)}
.share-link{margin-left:6px;font-size:19px;cursor:pointer}
.share-count{font-size:16px;margin-right:4px}
.action-button{display:block;margin:10px 0 0;padding:10px 20px;background:var(--theme);color:#fff;border:none;border-radius:20px;font-size:16px;cursor:pointer;font-weight:bold;text-align:left}
</style>
</head>
<body>
<div class="app-container">
  <div class="header">
    <a href="https://futurofortissimo.github.io/"><img src="/index_files/ff.png" class="logo" alt="logo"></a>
    <div class="buttons-container" id="buttons-container"></div>
    <button class="language-switch" id="language-switch">ðŸ‡®ðŸ‡¹</button>
  </div>
  <div class="progress-bar"></div>
  <div class="cards-container">
    <div class="cards-wrapper" id="cards-wrapper"></div>
  </div>
</div>

<script>
// ------------------ CONTENT PLACEHOLDER (ridotto) ------------------
const content={en:{chapters:[{title:"Example",buttonLabel:"ðŸ’¡ Example",contentBlocks:[{type:"questions",content:["How?","Why?"]}]}],bookDetails:{image:"",title:"",author:"",year:"",pages:"",link:"#",offerCoffeeLink:"#"}},it:{chapters:[],bookDetails:{}}};
// ------------------ END PLACEHOLDER ------------------

let currentLanguage='en';
const buttonsContainer=document.getElementById('buttons-container');
const cardsWrapper=document.getElementById('cards-wrapper');
const progressBar=document.querySelector('.progress-bar');
const languageSwitch=document.getElementById('language-switch');
let cards=[],currentIndex=0;

function initializeApp(){
  buttonsContainer.innerHTML='';cardsWrapper.innerHTML='';cards=[];currentIndex=0;
  const {chapters,bookDetails}=content[currentLanguage];
  chapters.forEach((ch,i)=>{createButton(ch.buttonLabel,i);createCard(ch,i)});
  createButton('ðŸ“– Details',chapters.length);createBookCard(bookDetails);
  // se URL contiene ?card=
  const shared=new URLSearchParams(location.search).get('card');
  if(shared){const idx=cards.findIndex(c=>c.dataset.cardId===shared);if(idx>-1)showCard(idx);
             fetch(`https://api.countapi.xyz/hit/futurofortissimo/${shared}`).then(r=>r.json()).then(j=>updateShareCount(shared,j.value));}
  else showCard(0);
}

function createButton(label,index){
  const b=document.createElement('div');b.className='button';b.textContent=label;
  b.onclick=()=>showCard(index);buttonsContainer.appendChild(b);
}

function createContentBlock(type,contents){
  const d=document.createElement('div');d.className=`content-block ${type}`;
  contents.forEach(t=>{const p=document.createElement('p');p.textContent=t;d.appendChild(p)});return d;
}

function addShareElements(titleEl,cardId){
  const count=document.createElement('span');count.className='share-count';count.textContent=' ðŸ’Œ â€”';
  const link=document.createElement('span');link.className='share-link';link.textContent='ðŸ”—';
  link.title=currentLanguage==='en'?'Share':'Condividi';
  link.onclick=()=>generateShareURL(cardId);titleEl.appendChild(count);titleEl.appendChild(link);
}

function fetchInitialCount(cardId){
  fetch(`https://api.countapi.xyz/get/futurofortissimo/${cardId}`)
    .then(r=>r.json()).then(j=>updateShareCount(cardId,j.value||0));
}

function createCard(chapter,idx){
  const cardId=`${chapter.urlSlug||'pub'}_${idx}`;
  const c=document.createElement('div');c.className='card';c.dataset.cardId=cardId;
  const cc=document.createElement('div');cc.className='card-content';
  const title=document.createElement('h2');title.className='section-title';title.textContent=chapter.title;
  addShareElements(title,cardId);cc.appendChild(title);
  chapter.contentBlocks.forEach(b=>cc.appendChild(createContentBlock(b.type,b.content)));
  c.appendChild(cc);cardsWrapper.appendChild(c);cards.push(c);
  fetchInitialCount(cardId);
}

function createBookCard(bd){
  const cardId='book_0';
  const c=document.createElement('div');c.className='card';c.dataset.cardId=cardId;
  const cc=document.createElement('div');cc.className='card-content book-details';
  cc.innerHTML=`<img src="${bd.image}" style="width:100%;border-radius:10px"><h2 class="section-title">${bd.title}</h2>
  <p>${currentLanguage==='en'?'Author':'Autore'}: ${bd.author}</p>
  <p>${currentLanguage==='en'?'Year':'Anno'}: ${bd.year}</p>
  <p>${currentLanguage==='en'?'Pages':'Pagine'}: ${bd.pages}</p>
  <button class="action-button" onclick="window.open('${bd.link}','_blank')">ðŸ“– ${currentLanguage==='en'?'Buy this book':'Acquista il libro'}</button>
  <button class="action-button" onclick="window.open('${bd.offerCoffeeLink}','_blank')">â˜• ${currentLanguage==='en'?'Offer me a coffee':'Offrimi un caffÃ¨'}</button>`;
  addShareElements(cc.querySelector('.section-title'),cardId);
  c.appendChild(cc);cardsWrapper.appendChild(c);cards.push(c);
  fetchInitialCount(cardId);
}

function generateShareURL(cardId){
  const url=`${location.origin}${location.pathname}?card=${encodeURIComponent(cardId)}`;
  navigator.clipboard.writeText(url).then(()=>alert(currentLanguage==='en'?'Link copied!':'Link copiato!'));
}

function updateShareCount(cardId,val){
  const el=[...document.querySelectorAll('.card')].find(c=>c.dataset.cardId===cardId)
    ?.querySelector('.share-count');
  if(el)el.textContent=` ðŸ’Œ ${val}`;
}

function showCard(i){
  currentIndex=i;cardsWrapper.style.transform=`translateX(-${i*100}%)`;
  progressBar.style.width=`${((i+1)/cards.length)*100}%`;
}

// swipe & drag (immutato rispetto a v2.0)
let startX=0,isDown=false;
const cont=document.querySelector('.cards-container');
cont.addEventListener('touchstart',e=>{startX=e.touches[0].clientX;isDown=true;cardsWrapper.style.transition='none'},false);
cont.addEventListener('touchmove',e=>{if(!isDown)return;const x=e.touches[0].clientX;cardsWrapper.style.transform=`translateX(${(-currentIndex*100)+((x-startX)/window.innerWidth)*100}%)`},false);
cont.addEventListener('touchend',e=>{if(!isDown)return;isDown=false;
  const dx=e.changedTouches[0].clientX-startX;if(dx<-50&&currentIndex<cards.length-1)currentIndex++;
  else if(dx>50&&currentIndex>0)currentIndex--;cardsWrapper.style.transition='transform .5s';showCard(currentIndex)},false);
cont.addEventListener('mousedown',e=>{startX=e.clientX;isDown=true;cardsWrapper.style.transition='none'},false);
cont.addEventListener('mousemove',e=>{if(!isDown)return;cardsWrapper.style.transform=`translateX(${(-currentIndex*100)+((e.clientX-startX)/window.innerWidth)*100}%)`},false);
['mouseup','mouseleave'].forEach(evt=>cont.addEventListener(evt,e=>{if(!isDown)return;isDown=false;
  const dx=e.clientX-startX;if(dx<-50&&currentIndex<cards.length-1)currentIndex++;
  else if(dx>50&&currentIndex>0)currentIndex--;cardsWrapper.style.transition='transform .5s';showCard(currentIndex)},false));

languageSwitch.onclick=()=>{currentLanguage=currentLanguage==='en'?'it':'en';
  languageSwitch.textContent=currentLanguage==='en'?'ðŸ‡®ðŸ‡¹':'ðŸ‡¬ðŸ‡§';initializeApp()};

document.addEventListener('DOMContentLoaded',initializeApp);
</script>
</body>
</html>