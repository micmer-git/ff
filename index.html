<!DOCTYPE html>
<html lang="it" id="roothtml">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>futuro fortissimo â€“ explorer</title>

  <!-- Google Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Tailwind (CDN build) -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['"Google Sans"', 'Roboto', 'ui-sans-serif'] },
          colors:     { ioBg:  '#F6F9FE' },
          boxShadow:  { neu:   '4px 4px 8px rgba(0,0,0,.06)' }
        }
      }
    };
  </script>

  <style>
    body { background: #F6F9FE }
    mark { background: #FFEB3B66; padding: 0 2px; border-radius: 3px }
    .pill, .tag {
      background: #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,.1);
      padding: 4px 12px;
      border-radius: 9999px;
      user-select: none;
      transition: .15s;
      white-space: nowrap;
    }
    .pill { cursor: pointer; font-size: 1.1rem }
    .pill.active { outline: 2px solid #38bdf8 }
    .hide-scrollbar::-webkit-scrollbar { display: none }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none }
    .scroll-snap-x { scroll-snap-type: x mandatory }
    .snap-start { scroll-snap-align: start }

    .exp-card { transform: scale(.95); opacity: 0; transition: transform .35s ease, opacity .35s ease }
    .exp-card.enter { transform: scale(1); opacity: 1 }
    .exp-card.exit { transform: scale(.9); opacity: 0 }
    .expander {
      position: absolute; right: 10px; bottom: 10px;
      background: #fff; border-radius: 9999px; padding: 6px 9px;
      font-size: 18px; box-shadow: 0 1px 4px rgba(0,0,0,.15);
      cursor: pointer;
    }
  </style>
</head>

<body class="font-sans text-gray-800 antialiased text-[18px]">
  <header class="py-2">
    <div class="max-w-3xl mx-auto flex items-center justify-center gap-3 px-4">
      <a href="https://fortissimo.substack.com" target="_blank" class="flex items-center gap-3">
        <img src="logo.png" alt="logo Futuro Fortissimo" class="h-8" />
        <h1 class="italic lowercase text-3xl font-semibold">futuro fortissimo</h1>
      </a>
    </div>
  </header>

  <section class="max-w-3xl mx-auto px-4 space-y-3">
    <div class="relative">
      <input id="searchInput" placeholder="search / cercaâ€¦" class="w-full rounded-full py-2 pl-11 pr-4 bg-white shadow-neu focus:outline-none focus:ring-2 focus:ring-sky-400" />
      <span class="absolute left-4 top-1/2 -translate-y-1/2 text-lg">ğŸ”</span>
    </div>
    <div id="filterRow" class="flex gap-2 overflow-x-auto hide-scrollbar scroll-snap-x pb-2 px-4">
      <span class="pill" data-filter="ğŸ’»">ğŸ’»</span>
      <span class="pill" data-filter="ğŸƒ">ğŸƒ</span>
      <span class="pill" data-filter="â¤ï¸">â¤ï¸</span>
      <span class="pill" data-filter="ğŸ’¸">ğŸ’¸</span>
      <span class="pill" data-filter="âš½">âš½</span>
      <span class="pill" data-filter="ğŸ½">ğŸ½</span>
      <span class="pill" data-filter="ğŸ§ ">ğŸ§ </span>
      <span class="pill" data-filter="ğŸ’Š">ğŸ’Š</span>
      <span class="pill" data-filter="ğŸ¨">ğŸ¨</span>
      <span class="pill" data-filter="ğŸš•">ğŸš•</span>
      <span class="pill" data-filter="ğŸ¥½">ğŸ¥½</span>
      <span class="pill" data-filter="ğŸ‘¥">ğŸ‘¥</span>
      <span class="pill" data-filter="ğŸ’†">ğŸ’†</span>
      <span class="pill" data-filter="ğŸ“–">ğŸ“–</span>
    </div>
  </section>

  <main id="app" class="max-w-3xl mx-auto px-4 pb-32 space-y-6 mt-6"></main>

  <footer class="fixed bottom-0 inset-x-0 flex items-center justify-center gap-3 py-2 text-base bg-ioBg/90 backdrop-blur">
    <button onclick="window.open('https://www.paypal.com/paypalme/michelemerelli','_blank')" class="pill">â˜• sostieni</button>
    <button onclick="window.open('https://linktr.ee/micmer','_blank')" class="pill">ğŸ‘¤ chi&nbsp;sono</button>
    <button id="langToggle" class="pill">ğŸ‡¬ğŸ‡§ english</button>
  </footer>

  <script>
    let LANG='it';
    const PATH={ it:'newsletter_data.json', en:'newsletter_data_en.json' };
    const NOTES_PATH='notes.json';
    const BOOKS_PATH='books.json';
    let DATA, NOTES, BOOKS;
    const filters=new Set();
    const gradients=[
      'linear-gradient(135deg,#38bdf8,#c084fc)',
      'linear-gradient(135deg,#f472b6,#facc15)',
      'linear-gradient(135deg,#34d399,#60a5fa)',
      'linear-gradient(135deg,#f87171,#fb923c)',
      'linear-gradient(135deg,#a78bfa,#f472b6)',
      'linear-gradient(135deg,#fb923c,#fde68a)',
      'linear-gradient(135deg,#5eead4,#3b82f6)',
      'linear-gradient(135deg,#fda4af,#c4b5fd)'
    ];
    const $=s=>document.querySelector(s);
    const match=(t,s)=>t.toLowerCase().includes(s);
    const hl=(t,s)=>s?t.replace(new RegExp(`(${s})`,'gi'),'<mark>$1</mark>'):t;

    $('#filterRow').addEventListener('click',e=>{
      const f=e.target.dataset.filter; if(!f) return;
      filters.has(f)?filters.delete(f):filters.add(f);
      e.target.classList.toggle('active');
      render();
    });
    $('#searchInput').oninput=render;
    $('#langToggle').onclick=()=>{
      LANG = LANG==='it'?'en':'it';
      document.documentElement.lang=LANG;
      $('#langToggle').textContent=LANG==='it'?'ğŸ‡¬ğŸ‡§ english':'ğŸ‡®ğŸ‡¹ italiano';
      loadAll();
    };

    async function loadAll(){
      [DATA,NOTES,BOOKS] = await Promise.all([
        fetch(PATH[LANG]).then(r=>r.json()),
        fetch(NOTES_PATH).then(r=>r.json()),
        fetch(BOOKS_PATH).then(r=>r.json())
      ]);
      render();
    }

    function render(){
      const term=$('#searchInput').value.toLowerCase();
      const activeS=term.length>0;
      const activeF=filters.size>0;
      const bookFilter=filters.has('ğŸ“–');
      const wrap=$('#app'); wrap.innerHTML='';

      // BOOKS ONLY VIEW
      if(bookFilter && !activeS){
        const shuffled=[...BOOKS].sort(()=>Math.random()-0.5);
        wrap.appendChild(makeBookVertical(shuffled));
        return;
      }
      // DEFAULT VIEW
      if(!activeS && !activeF){
        wrap.appendChild(makePubStrip(DATA.publications));
        const shuffled=[...BOOKS].sort(()=>Math.random()-0.5);
        wrap.appendChild(makeBookStrip(shuffled));
        return;
      }

      // FILTER/SEARCH VIEW
      DATA.publications.forEach((pub,idx)=>{
        let vis=pub.cards.filter(c=>!c.title.startsWith('ğŸ“–')).filter(c=>{
          const tagOk = !activeF || c.tags.some(t=>filters.has(t));
          const txtOk = !activeS
            || match(c.title,term)
            || c.contentBlocks.flatMap(b=>b.content).some(l=>match(l,term));
          return tagOk && txtOk;
        });
        if(vis.length){
          wrap.appendChild(makePubCard(pub,vis,idx,true,term,activeF));
        }
      });

      // matched BOOK QUOTES
      if(activeS){
        const matched=BOOKS.filter(b=>match(b.text,term)||match(b.title,term));
        if(matched.length) wrap.appendChild(makeBookStrip(matched));
      }
    }

    function makePubStrip(list){
      const strip=document.createElement('div');
      strip.className='flex gap-4 overflow-x-auto hide-scrollbar scroll-snap-x pb-2';
      list.forEach((pub,i)=>{
        const c=document.createElement('div');
        c.className='relative rounded-xl flex-shrink-0 snap-start w-full max-w-[320px] cursor-pointer';
        c.style.cssText=`background:${gradients[i%gradients.length]};padding:2px`;
        const inr=document.createElement('div');
        inr.className='bg-white rounded-xl p-5 shadow-neu h-40 flex flex-col justify-center';
        const pano=pub.cards.find(x=>x.title.startsWith('ğŸ“–'));
        inr.innerHTML=`
          <h3 class="font-semibold text-xl text-center mb-2">${pub.title}</h3>
          ${pano?`<p class="text-base text-center">${pano.contentBlocks[0].content[0]}</p>`:''}`;
        c.appendChild(inr);
        const btn=document.createElement('button');
        btn.className='expander'; btn.textContent='â¤¢';
        btn.onclick=e=>{ e.stopPropagation(); openExpanded(pub); };
        c.appendChild(btn);
        c.onclick=()=>openExpanded(pub);
        strip.appendChild(c);
      });
      return strip;
    }

    function makeBookStrip(quotes){
      const strip=document.createElement('div');
      strip.className='flex gap-4 overflow-x-auto hide-scrollbar scroll-snap-x pb-2 mt-4';
      quotes.forEach(b=>{
        const q=document.createElement('div');
        q.className='flex-shrink-0 snap-start bg-white rounded-xl p-5 shadow-neu max-w-[300px] text-[15px] break-words cursor-pointer';
        if(b.url) q.onclick=()=>window.open(b.url,'_blank');
        q.innerHTML=`
          <h3 class="font-semibold text-lg mb-1">${b.title}</h3>
          <p class="font-medium">&ldquo;${b.text}&rdquo;</p>
          <p class="text-xs text-gray-600 mt-2">${b.book} â€” ${b.author}</p>`;
        strip.appendChild(q);
      });
      return strip;
    }

    function makeBookVertical(quotes){
      const c=document.createElement('div');
      c.className='space-y-6';
      quotes.forEach(b=>{
        const q=document.createElement('div');
        q.className='bg-white rounded-xl p-5 shadow-neu text-[15px] break-words cursor-pointer';
        if(b.url) q.onclick=()=>window.open(b.url,'_blank');
        q.innerHTML=`
          <h3 class="font-semibold text-lg mb-1">${b.title}</h3>
          <p>&ldquo;${b.text}&rdquo;</p>
          <p class="text-sm text-gray-600 mt-2">${b.book} â€” ${b.author}</p>`;
        c.appendChild(q);
      });
      return c;
    }

    function makePubCard(pub, scList, idx, cond, term, showTags){
      const card=document.createElement('div');
      card.className='pub-card rounded-xl mb-4';
      card.style.cssText=`background:${gradients[idx%gradients.length]};padding:2px`;
      const inner=document.createElement('div');
      inner.className='bg-white rounded-xl p-5 shadow-neu flex flex-col';
      scList.forEach((sc,i)=>{
        inner.innerHTML+=`
          <div>
            <h3 class="font-semibold mb-1">${cond?hl(sc.title,term):sc.title}</h3>
            ${sc.contentBlocks[0].content.map(l=>`<p class="text-base">${cond?hl(l,term):l}</p>`).join('')}
            ${showTags?`<div class="flex flex-wrap gap-1 mt-1">${sc.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>`:''}
          </div>
          ${i<scList.length-1?'<hr class="border-t my-3"/':''}`;
      });
      inner.onclick=()=>window.open(pub.substackLink,'_blank');
      card.appendChild(inner);
      return card;
    }

    function openExpanded(pub){
      document.querySelectorAll('.exp-card').forEach(x=>x.remove());
      $('#pubStrip')?.classList.add('hidden');
      const wrap=$('#app');
      const idx=DATA.publications.findIndex(p=>p.title===pub.title);
      const sc=pub.cards.filter(c=>!c.title.startsWith('ğŸ“–'));
      const card=makePubCard(pub,sc,idx,false,'',false);
      card.classList.add('exp-card');
      wrap.prepend(card);
      const close=document.createElement('button');
      close.textContent='âœ•'; close.className='absolute top-2 right-2 text-2xl';
      close.onclick=()=>{
        card.classList.remove('enter'); card.classList.add('exit');
        setTimeout(()=>{
          card.remove();
          $('#pubStrip')?.classList.remove('hidden');
        },350);
      };
      card.style.position='relative';
      card.appendChild(close);
      requestAnimationFrame(()=>card.classList.add('enter'));
      card.scrollIntoView({behavior:'smooth',block:'center'});
    }

    loadAll();
  </script>
</body>
</html>

