<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>futuro fortissimo ‚Äì explorer</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:ital@700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f6f9fe;--fg:#111;--acc:#38bdf8;
  --hdr:60px;--srch:60px;--side:46px
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:Inter,sans-serif;background:var(--bg);color:var(--fg);overflow:hidden}
a,button{all:unset;cursor:pointer}
mark{background:var(--acc);color:#fff;padding:0 3px;border-radius:3px}

/* HEADER ------------------------------------------------*/
header{position:fixed;top:0;left:0;right:0;height:var(--hdr);
       display:flex;align-items:center;justify-content:space-between;
       padding:0 6vw;z-index:20}
#logoWrap{display:flex;align-items:center;gap:.55rem}
#logoWrap img{height:34px}
#logoWrap h1{font-family:"Playfair Display",serif;font-size:1.55rem;font-style:italic}
#ctaHead{display:flex;gap:.9rem;font-size:1.8rem}

/* SIDE BAR ---------------------------------------------*/
#gutter{position:fixed;top:var(--hdr);bottom:var(--srch);right:0;width:var(--side);
        display:flex;flex-direction:column;align-items:center;gap:.45rem;padding-top:.7rem;overflow-y:auto}
.tag{font-size:1.38rem;padding:.12rem;border-radius:50%;cursor:pointer;transition:.2s}
.tag.active{background:var(--acc);color:#fff}

/* CANVAS -----------------------------------------------*/
#canvas{position:fixed;top:var(--hdr);left:0;right:var(--side);bottom:var(--srch);
        overflow-y:auto;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch}
.page{min-height:calc(100vh - var(--hdr) - var(--srch));
      display:flex;align-items:center;justify-content:flex-start;padding-left:6vw;
      scroll-snap-align:start}
.box{max-width:720px;width:calc(100% - 12vw);max-height:80vh;overflow-y:auto}
.box::-webkit-scrollbar{display:none}
.box h2{font-size:1.44rem;font-weight:700;margin-bottom:.65rem;text-wrap:balance}
.box h3{font-size:1.3rem;font-weight:700;margin:.45rem 0 .4rem}
.box p{font-size:1.16rem;line-height:1.55;margin-bottom:.8rem}
.book h2{font-size:1.26rem}.book p{font-size:1.06rem}
.src{font-size:.8rem;color:#555;margin-top:.34rem}

/* SEARCH BAR -------------------------------------------*/
#searchWrap{position:fixed;left:0;right:0;bottom:0;height:var(--srch);
            background:var(--bg);display:flex;align-items:center;padding:0 6vw;
            gap:.7rem;border-top:1px solid #ddd;z-index:15}
#search{flex:1;font-size:1.25rem;padding:.55rem 1.05rem;border-radius:999px;
        border:2px solid var(--fg);background:#fff;outline:none}
#searchBtn{font-size:2rem;color:var(--acc);line-height:1}
</style>
</head>

<body>
<!-- header -->
<header>
  <div id="logoWrap"><img src="logo.png" alt="logo"><h1>futuro&nbsp;fortissimo</h1></div>
  <div id="ctaHead">
    <div onclick="openExt('https://www.paypal.com/paypalme/michelemerelli')">‚òï</div>
    <div onclick="openExt('https://linktr.ee/micmer')">üë§</div>
  </div>
</header>

<!-- side bar emoji -->
<div id="gutter"></div>

<!-- vertical canvas -->
<div id="canvas"></div>

<!-- search bottom -->
<div id="searchWrap">
  <input id="search" placeholder="search / cerca‚Ä¶" />
  <button id="searchBtn">üîç</button>
</div>

<script>
/* ---------- paths ---------- */
const PATH={it:'newsletter_data.json',en:'newsletter_data_en.json'},
      NOTES_P='notes.json',BOOKS_P='books.json';

/* ---------- state ---------- */
let LANG='it',PUBS,NOTES,BOOKS;
const sel=new Set(), tagAll=['üìö','üé∂','üíª','üçÉ','‚ù§Ô∏è','üí∏','‚öΩ','üçΩ','üß†','üíä','üé®','üöï','ü•Ω','üë•','üíÜ'];

/* ---------- helpers ---------- */
const $=s=>document.querySelector(s),
      rnd=a=>a.sort(()=>Math.random()-.5),
      openExt=u=>window.open(u,'_blank'),
      mark=(t,q)=>q?t.replace(new RegExp(`(${q})`,'gi'),'<mark>$1</mark>'):t;

/* ---------- side bar ---------- */
const gut=$('#gutter');
tagAll.forEach(e=>{
  const d=document.createElement('div');d.textContent=e;d.className='tag';
  d.onclick=()=>{d.classList.toggle('active');sel.has(e)?sel.delete(e):sel.add(e);render();};
  gut.appendChild(d);
});

/* ---------- search ---------- */
let q='';const sIn=$('#search');
$('#searchBtn').onclick=()=>{q=sIn.value.trim().toLowerCase();sIn.blur();render();};
sIn.oninput=()=>{q=sIn.value.trim().toLowerCase();render();};

/* ---------- data ---------- */
Promise.all([
 fetch(PATH.it).then(r=>r.json()),
 fetch(NOTES_P).then(r=>r.json()),
 fetch(BOOKS_P).then(r=>r.json())
]).then(([d,n,b])=>{
  PUBS=d.publications;
  NOTES=n.notes.map(o=>({...o,tags:['üé∂']}));
  BOOKS=b.map(o=>({...o,tags:['üìö']}));
  shuffleAll();render();
});

/* ---------- shuffle stacks ---------- */
function shuffleAll(){
  PUBS=rnd(PUBS);NOTES=rnd(NOTES);BOOKS=rnd(BOOKS);
}

/* ---------- filtering ---------- */
const tagOK=(o)=>sel.size?o.tags?.some(t=>sel.has(t)):true;
function searchOK(text){return q?text.toLowerCase().includes(q):true;}

/* ---------- render ---------- */
function render(){
 const cv=$('#canvas');cv.innerHTML='';let stack=[];

 /* build candidate list */
 if(q||sel.size){ // filtered
   PUBS.forEach(p=>p.cards.filter(c=>!c.title.startsWith('üìñ')&&tagOK(c)&&(searchOK(c.title)||c.contentBlocks[0].content.some(l=>searchOK(l))))
              .forEach(c=>stack.push(pubCard(p,c,true))));
   BOOKS.forEach(b=>tagOK(b)&&(searchOK(b.title)||searchOK(b.text))&&stack.push(bookCard(b,true)));
   NOTES.forEach(n=>tagOK(n)&&searchOK(n.title)&&stack.push(noteCard(n,true)));
 }
 else{ // home: everything random
   PUBS.forEach(p=>p.cards.filter(c=>!c.title.startsWith('üìñ')).forEach(c=>stack.push(pubCard(p,c,false))));
   BOOKS.forEach(b=>stack.push(bookCard(b,false)));
   NOTES.forEach(n=>stack.push(noteCard(n,false)));
   stack=rnd(stack);
 }

 /* mount pages */
 stack.forEach(el=>cv.appendChild(pageWrap(el)));
 cv.scrollTo(0,0);
}

/* ---------- factories ---------- */
function pageWrap(child){const s=document.createElement('section');s.className='page';s.appendChild(child);return s;}

function pubCard(pub,sub,hi){
 const d=document.createElement('div');d.className='box';d.style.background='transparent';
 d.innerHTML=`<h3>${hi?mark(sub.title,q):sub.title}</h3>`+
             sub.contentBlocks[0].content.map(l=>`<p>${hi?mark(l,q):l}</p>`).join('')+
             `<div class="mt-2">${(sub.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}</div>`;
 d.onclick=()=>openExt(pub.substackLink);return d;
}

function bookCard(b,hi){
 const d=document.createElement('div');d.className='box book';
 d.innerHTML=`<h2>${hi?mark(b.title,q):b.title}</h2><p>${hi?mark(b.text,q):b.text}</p>
              <p class="src">${b.book} ‚Äî ${b.author}</p>`;
 if(b.url)d.onclick=()=>openExt(b.url);return d;
}

function noteCard(n,hi){
 const host=n.url?new URL(n.url).hostname.replace(/^www\./,''):'';
 const d=document.createElement('div');d.className='box';
 d.innerHTML=`<h2>${hi?mark(n.title,q):n.title}</h2>${host?`<p class="src">${host}</p>`:''}`;
 if(n.url)d.onclick=()=>openExt(n.url);return d;
}
</script>
</body>
</html>