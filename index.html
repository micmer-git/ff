<!DOCTYPE html>
<html lang="it" id="roothtml">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>futuro fortissimo – explorer</title>

  <!-- Google Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Tailwind (CDN build) -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['"Google Sans"', 'Roboto', 'ui-sans-serif'] },
          colors:     { ioBg:  '#F6F9FE' },
          boxShadow:  { neu:   '4px 4px 8px rgba(0,0,0,.06)' }
        }
      }
    };
  </script>

  <style>
    body{background:#F6F9FE}
    mark{background:#FFEB3B66;padding:0 2px;border-radius:3px}
    .pill,.tag{background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.1);padding:4px 12px;border-radius:9999px;user-select:none;transition:.15s}
    .pill{cursor:pointer;font-size:1.1rem}.pill.active{outline:2px solid #38bdf8}
    .hide-scrollbar::-webkit-scrollbar{display:none}
    .hide-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
    .scroll-snap-x{scroll-snap-type:x mandatory}
    .snap-start{scroll-snap-align:start}
    .exp-card{transform:scale(.95);opacity:0;transition:transform .35s ease,opacity .35s ease}
    .exp-card.enter{transform:scale(1);opacity:1}
    .exp-card.exit{transform:scale(.9);opacity:0}
    .expander{position:absolute;right:10px;bottom:10px;background:#ffffff;border-radius:9999px;padding:6px 9px;font-size:18px;box-shadow:0 1px 4px rgba(0,0,0,.15);cursor:pointer}
  </style>
</head>

<body class="font-sans text-gray-800 antialiased text-[18px]">
<header class="py-2">
  <div class="max-w-3xl mx-auto flex items-center justify-center gap-3 px-4">
    <img src="logo.png" alt="logo Futuro Fortissimo" class="h-8" />
    <h1 class="italic lowercase text-3xl font-semibold">futuro fortissimo</h1>
  </div>
</header>

<section class="max-w-3xl mx-auto px-4 space-y-3">
  <div class="relative">
    <input id="searchInput" placeholder="search / cerca…" class="w-full rounded-full py-2 pl-11 pr-4 bg-white shadow-neu focus:outline-none focus:ring-2 focus:ring-sky-400" />
    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-lg">🔍</span>
  </div>
  <div id="filterRow" class="flex flex-wrap justify-center gap-2 text-xl">
    <span class="pill" data-filter="💻">💻</span><span class="pill" data-filter="🍃">🍃</span><span class="pill" data-filter="❤️">❤️</span>
    <span class="pill" data-filter="💸">💸</span><span class="pill" data-filter="⚽">⚽</span><span class="pill" data-filter="🍽">🍽</span>
    <span class="pill" data-filter="🧠">🧠</span><span class="pill" data-filter="💊">💊</span><span class="pill" data-filter="🎨">🎨</span>
    <span class="pill" data-filter="🚕">🚕</span><span class="pill" data-filter="🥽">🥽</span><span class="pill" data-filter="👥">👥</span><span class="pill" data-filter="💆">💆</span>
  </div>
</section>

<main id="app" class="max-w-3xl mx-auto px-4 pb-32 space-y-6 mt-6"></main>

<footer class="fixed bottom-0 inset-x-0 flex items-center justify-center gap-3 py-2 text-base bg-ioBg/90 backdrop-blur">
  <button onclick="window.open('https://www.paypal.com/paypalme/michelemerelli','_blank')" class="pill">☕ sostieni</button>
  <button onclick="window.open('https://linktr.ee/micmer','_blank')" class="pill">👤 chi&nbsp;sono</button>
  <button id="langToggle" class="pill">🇬🇧 english</button>
</footer>

<script>
let LANG='it',
    PATH={it:'newsletter_data.json',en:'newsletter_data_en.json'},
    NOTES_PATH='notes.json',
    BOOKS_PATH='books.json';

let DATA, NOTES, BOOKS,
    filters=new Set(),
    gradients=[
      'linear-gradient(135deg,#38bdf8,#c084fc)',
      'linear-gradient(135deg,#f472b6,#facc15)',
      'linear-gradient(135deg,#34d399,#60a5fa)',
      'linear-gradient(135deg,#f87171,#fb923c)',
      'linear-gradient(135deg,#a78bfa,#f472b6)',
      'linear-gradient(135deg,#fb923c,#fde68a)',
      'linear-gradient(135deg,#5eead4,#3b82f6)',
      'linear-gradient(135deg,#fda4af,#c4b5fd)'
    ];

const $=s=>document.querySelector(s),
      match=(t,s)=>t.toLowerCase().includes(s),
      hl=(t,s)=>s?t.replace(new RegExp(`(${s})`,'gi'),'<mark>$1</mark>'):t;

$('#filterRow').addEventListener('click',e=>{
  if(!e.target.dataset.filter) return;
  const f=e.target.dataset.filter;
  e.target.classList.toggle('active');
  filters.has(f)?filters.delete(f):filters.add(f);
  render();
});
$('#searchInput').oninput=render;
$('#langToggle').onclick=()=>{
  LANG=LANG==='it'?'en':'it';
  $('#langToggle').textContent=LANG==='it'?'🇬🇧 english':'🇮🇹 italiano';
  document.documentElement.lang=LANG;
  loadAll();
};

async function loadAll(){
  [DATA,NOTES,BOOKS]=await Promise.all([
    fetch(PATH[LANG]).then(r=>r.json()),
    fetch(NOTES_PATH).then(r=>r.json()),
    fetch(BOOKS_PATH).then(r=>r.json())
  ]);
  DATA.publications.sort(()=>Math.random()-0.5);
  filters.clear();
  document.querySelectorAll('.pill.active').forEach(p=>p.classList.remove('active'));
  $('#searchInput').value='';
  render();
}

function render(){
  const term=$('#searchInput').value.toLowerCase(),
        activeS=term.length>0,
        activeF=filters.size>0,
        wrap=$('#app');
  wrap.innerHTML='';

  if(!activeS && !activeF){
    wrap.appendChild(makePubStrip(DATA.publications));
  }

  let shown=0;
  DATA.publications.forEach((pub,idx)=>{
    const vis=pub.cards
      .filter(sc=>!sc.title.startsWith('📖'))
      .filter(sc=>{
        const tagOk=!activeF||sc.tags?.some(t=>filters.has(t));
        const txtOk=!activeS||(match(sc.title,term)||sc.contentBlocks.some(b=>b.content.some(l=>match(l,term))));
        return tagOk&&txtOk;
      });
    if(!vis.length) return;
    wrap.appendChild(makePubCard(pub,idx));
    shown++;
    if(shown===1 && !activeS && !activeF){
      wrap.appendChild(makeBooksStrip(BOOKS));   // prime le quotes
      wrap.appendChild(makeNotesStrip(NOTES.notes)); // poi le notes
    }
  });
}

function makePubStrip(list){ /* identico a prima */ }

function makePubCard(pub,idx){
  const card=document.createElement('div');
  card.className='pub-card relative rounded-xl overflow-hidden mb-4 cursor-pointer';
  card.style.cssText=`background:${gradients[idx%gradients.length]};padding:2px`;
  const inner=document.createElement('div');
  inner.className='bg-white rounded-xl p-5 shadow-neu';
  inner.innerHTML=`<h3 class="font-semibold text-xl">${pub.title}</h3>`;
  inner.onclick=()=>openExpanded(pub);
  card.appendChild(inner);
  const btn=document.createElement('button');
  btn.className='expander'; btn.textContent='⤢';
  btn.onclick=e=>{e.stopPropagation();openExpanded(pub);};
  card.appendChild(btn);
  return card;
}

function openExpanded(pub){ /* identico a prima */ }

function makeNotesStrip(notes){
  const strip=document.createElement('div');
  strip.className='flex gap-4 overflow-x-auto hide-scrollbar scroll-snap-x scroll-smooth pb-2';
  notes.sort(()=>Math.random()-0.5).forEach(n=>{
    const c=document.createElement('div');
    c.className='rounded-xl border-2 border-black flex-shrink-0 w-full max-w-[280px] p-4 bg-white text-[14px]';
    c.innerHTML=`
      <h4 class="font-medium mb-1">${n.title}</h4>
      <p class="mb-2">${n.description||''}</p>
      <span class="tag text-xs">${new URL(n.url).hostname.replace(/^www\./,'')}</span>
    `;
    c.onclick=()=>window.open(n.url,'_blank');
    strip.appendChild(c);
  });
  return strip;
}

function makeBooksStrip(books){
  const strip=document.createElement('div');
  strip.className='flex gap-4 overflow-x-auto hide-scrollbar scroll-snap-x scroll-smooth pb-2';
  books.sort(()=>Math.random()-0.5).forEach(b=>{
    const c=document.createElement('div');
    c.className='rounded-xl border-2 border-indigo-500 flex-shrink-0 w-full max-w-[280px] p-4 bg-white text-[14px]';
    c.innerHTML=`
      <h4 class="font-medium mb-1">${b.title}</h4>
      <p class="mb-2">${b.text}</p>
      <a href="${b.url}" target="_blank" class="italic text-sm">${b.book} — ${b.author}</a>
    `;
    strip.appendChild(c);
  });
  return strip;
}

loadAll();
</script>
</body>
</html>
