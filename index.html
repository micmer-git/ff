<!DOCTYPE html>
<html lang="it" id="root">
<head>
Â  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
Â  <title>futuro fortissimo â€“ explorer</title>

Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:ital@700&display=swap" rel="stylesheet">
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <script>
Â  Â  tailwind.config = {
Â  Â  Â  theme: {
Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  fontFamily: {
Â  Â  Â  Â  Â  Â  sans: ['Inter', 'system-ui']
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  colors: {
Â  Â  Â  Â  Â  Â  bg: '#f6f9fe',
Â  Â  Â  Â  Â  Â  acc: '#38bdf8'
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  </script>
Â  <style>
Â  Â  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
Â  Â  body{font-family:Inter,sans-serif;background:var(--tw-bg-opacity) bg;color:#111;overflow:hidden}
Â  Â  mark{background:#38bdf8;color:#fff;padding:0 3px;border-radius:3px}
Â  Â  .pill,.tag{background:#fff;padding:4px 13px;border-radius:9999px;cursor:pointer;user-select:none;transition:.2s}
Â  Â  .pill{font-size:1.2rem}
Â  Â  .pill.active{outline:2px solid #38bdf8}
Â  Â  .tag{font-size:.85rem;margin-top:4px;margin-right:4px}
Â  Â  #canvas{scroll-snap-type:y mandatory;overflow-y:auto;-webkit-overflow-scrolling:touch}
Â  Â  .page{min-height:calc(100vh - 120px);scroll-snap-align:start;display:flex;align-items:center;padding-left:6vw}
Â  Â  .box{width:calc(100% - 12vw);max-width:720px;max-height:78vh;overflow-y:auto;padding:2rem 1.7rem}
Â  Â  .box::-webkit-scrollbar{display:none}
Â  Â  .box h3{font-size:1.35rem;font-weight:700;margin-bottom:.4rem}
Â  Â  .box p{font-size:1.15rem;line-height:1.6;margin-bottom:.65rem}
Â  Â  .box.book h3{font-size:1.15rem}
Â  Â  .src{font-size:.8rem;color:#555;margin-top:.3rem}

Â  Â  /* â€”â€” slightly larger fonts on desktop â€”â€” */
Â  Â  @media(min-width:1024px){
Â  Â  Â  .box h3{font-size:1.55rem}
Â  Â  Â  .box p{font-size:1.3rem}
Â  Â  }
Â  </style>
</head>
<body>
Â  Â  <header class="fixed inset-x-0 top-0 h-[60px] px-[6vw] flex items-center justify-between z-30">
Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  <img src="logo.png" class="h-8">
Â  Â  Â  <h1 class="font-[Playfair_Display] italic text-[1.55rem]">futuro&nbsp;fortissimo</h1>
Â  Â  </div>
Â  Â  <div id="cta" class="flex items-center gap-4 text-[2rem]">
Â  Â  Â  <span id="ctaCoffee">â˜•</span><span id="ctaAbout">ğŸ‘¤</span>
Â  Â  Â  <span id="langBtn" class="cursor-pointer">ğŸ‡¬ğŸ‡§</span>
Â  Â  </div>
Â  </header>

Â  Â  <aside id="side" class="fixed top-[60px] bottom-[60px] right-0 w-[46px] flex flex-col items-center gap-2 pt-3 overflow-y-auto"></aside>

Â  Â  <main id="canvas" class="fixed top-[60px] bottom-[60px] right-[46px] left-0"></main>

Â  Â  <footer class="fixed inset-x-0 bottom-0 h-[60px] bg-bg flex items-center px-[6vw] gap-3">
Â  Â  <input id="search" placeholder="cerca / searchâ€¦" class="flex-1 rounded-full border-2 border-black px-4 py-2 text-lg outline-none">
Â  Â  <button id="searchBtn" class="text-[1.8rem] text-acc">ğŸ”</button>
Â  </footer>

<script>
/******************************
Â *Â  Â  Â  Â  Â CONSTANTSÂ  Â  Â  Â  Â  *
Â ******************************/
const PATHÂ  = { it: 'newsletter_data.json', en: 'newsletter_data_en.json' },
Â  Â  Â  NOTES = 'notes.json',
Â  Â  Â  BOOKS = 'books.json',
Â  Â  Â  NOTE_TAG = 'ğŸ¶'; // â† keep the original note tag!

/******************************
Â *Â  Â  Â  Â  Â  Â STATEÂ  Â  Â  Â  Â  Â  *
Â ******************************/
let PUBS, NOTESARR, BOOKSARR, LANG = 'it', q = '';
const selTags = new Set();

/******************************
Â *Â  Â  Â  Â  Â  HELPERSÂ  Â  Â  Â  Â  Â *
Â ******************************/
const $Â  Â  Â = s => document.querySelector(s),
Â  Â  Â  rndÂ  Â = a => [...a].sort(()=>Math.random()-0.5), // nonâ€‘mutating shuffle
Â  Â  Â  match = t => t.includes(q),
Â  Â  Â  markÂ  = t => q ? t.replace(new RegExp(`(${q})`,'gi'),'<mark>$1</mark>') : t,
Â  Â  Â  pgÂ  Â  = c => { const p = document.createElement('section'); p.className='page'; p.appendChild(c); return p; },
Â  Â  Â  openÂ  = url => window.open(url,'_blank');

/******************************
Â *Â  Â  Â  Â  Â  UI SETUPÂ  Â  Â  Â  Â  *
Â ******************************/
const allTags = ['ğŸ“š', NOTE_TAG, 'ğŸ’»','ğŸƒ','â¤ï¸','ğŸ’¸','âš½','ğŸ½','ğŸ§ ','ğŸ’Š','ğŸ¨','ğŸš•','ğŸ¥½','ğŸ‘¥','ğŸ’†'];
const side = $('#side');
allTags.forEach(tag=>{
Â  const el=document.createElement('div');
Â  el.textContent=tag;
Â  el.className='pill';
Â  el.onclick=()=>{
Â  Â  el.classList.toggle('active');
Â  Â  selTags.has(tag)?selTags.delete(tag):selTags.add(tag);
Â  Â  render();
Â  };
Â  side.appendChild(el);
});

$('#ctaCoffee').onclick=()=>open('https://www.paypal.com/paypalme/michelemerelli');
$('#ctaAbout').onclick =()=>open('https://linktr.ee/micmer');
$('#langBtn').onclickÂ  Â =()=>{
Â  LANG = LANG==='it'?'en':'it';
Â  $('#langBtn').textContent = LANG==='it'?'ğŸ‡¬ğŸ‡§':'ğŸ‡®ğŸ‡¹';
Â  loadData();
};

const searchInput = $('#search');
searchInput.oninput =()=>{q=searchInput.value.trim().toLowerCase();render();};
$('#searchBtn').onclick =()=>{searchInput.blur();q=searchInput.value.trim().toLowerCase();render();};

/******************************
Â *Â  Â  Â  Â  Â DATA LOADÂ  Â  Â  Â  Â  *
Â ******************************/
function loadData(){
Â  Promise.all([
Â  Â  fetch(PATH[LANG]).then(r=>r.json()),
Â  Â  fetch(NOTES).then(r=>r.json()),
Â  Â  fetch(BOOKS).then(r=>r.json())
Â  ]).then(([pubData, noteData, bookData])=>{
Â  Â  PUBSÂ  Â  Â  = pubData.publications; // don't shuffle here - we'll shuffle per render
Â  Â  NOTESARRÂ  = noteData.notes.map(n => {
Â  Â  Â  const existingTags = n.tags?.length ? n.tags : [];
Â  Â  Â  // Ensure NOTE_TAG is always present if it's not already
Â  Â  Â  if (!existingTags.includes(NOTE_TAG)) {
Â  Â  Â  Â  existingTags.push(NOTE_TAG);
Â  Â  Â  }
Â  Â  Â  return { ...n, tags: existingTags };
Â  Â  });
Â  Â  BOOKSARRÂ  = bookData.map(b=>({...b, tags: b.tags?.length?b.tags:['ğŸ“š']}));

Â  Â  // reset filters/search UI
Â  Â  selTags.clear();
Â  Â  document.querySelectorAll('#side .pill.active').forEach(p=>p.classList.remove('active'));
Â  Â  q='';
Â  Â  searchInput.value='';

Â  Â  render();
Â  });
}

/******************************
Â *Â  Â  Â  Â  Â CARD FACTORYÂ  Â  Â  Â *
Â ******************************/
function pubCard(pub, scheda, highlight){
Â  const c=document.createElement('div');
Â  c.className='box';
Â  c.style.background='#fff';
Â  c.innerHTML=`<h3>${highlight?mark(scheda.title):scheda.title}</h3>`+
Â  Â  Â  Â  Â  Â  Â  scheda.contentBlocks[0].content.map(l=>`<p>${highlight?mark(l):l}</p>`).join('');
Â  c.onclick=()=>open(pub.substackLink);
Â  return pg(c);
}
function bookCard(b, highlight){
Â  const c=document.createElement('div');
Â  c.className='box book';
Â  c.style.background='#fff';
Â  c.innerHTML=`<h3>${highlight?mark(b.title):b.title}</h3>`+
Â  Â  Â  Â  Â  Â  Â  `<p>${highlight?mark(b.text):b.text}</p>`+
Â  Â  Â  Â  Â  Â  Â  `<p class='src'>${b.book} â€” ${b.author}</p>`;
Â  if(b.url) c.onclick=()=>open(b.url);
Â  return pg(c);
}
function noteCard(n, highlight){
Â  const host=n.url?new URL(n.url).hostname.replace(/^www\./,''):'';
Â  const c=document.createElement('div');
Â  c.className='box';
Â  c.style.background='#fff';
Â  c.innerHTML=`<h3>${highlight?mark(n.title):n.title}</h3>${host?`<p class='src'>${host}</p>`:''}`;
Â  if(n.url) c.onclick=()=>open(n.url);
Â  return pg(c);
}

/******************************
Â *Â  Â  Â  Â  Â  Â RENDERÂ  Â  Â  Â  Â  Â *
Â ******************************/
function render(){
Â  const cv = $('#canvas');
Â  cv.innerHTML='';

Â  const hasFilter = selTags.size>0,
Â  Â  Â  Â  hasQueryÂ  = q.length>0;
Â  let stack=[];

Â  // â€”â€” HOME (no filter, no search) â€”â€”
Â  if(!hasFilter && !hasQuery){
Â  Â  stack=[
Â  Â  Â  ...PUBS.flatMap(p=>p.cards.filter(c=>!c.title.startsWith('ğŸ“–')).map(c=>pubCard(p,c,false))),
Â  Â  Â  ...BOOKSARR.map(b=>bookCard(b,false)),
Â  Â  Â  ...NOTESARR.map(n=>noteCard(n,false))
Â  Â  ];
Â  Â  // Shuffle and append all items
Â  Â  rnd(stack).forEach(el=>cv.appendChild(el));
Â  }
Â  // â€”â€” ONLY TAG FILTER â€”â€”
Â  else if(hasFilter && !hasQuery){
Â  Â  // Handle books filter
Â  Â  if(selTags.has('ğŸ“š')){
Â  Â  Â  stack.push(...BOOKSARR.map(b=>bookCard(b,false)));
Â  Â  }
Â  Â  // Handle notes filter
Â  Â  if(selTags.has(NOTE_TAG)){
Â  Â  Â  stack.push(...NOTESARR.map(n=>noteCard(n,false)));
Â  Â  }
Â  Â  // Handle publication cards with matching tags
Â  Â  PUBS.forEach(p=>p.cards.filter(c=>!c.title.startsWith('ğŸ“–') && c.tags?.some(t=>selTags.has(t))).forEach(c=>stack.push(pubCard(p,c,false))));
Â  Â Â 
Â  Â  // Shuffle and append filtered items
Â  Â  rnd(stack).forEach(el=>cv.appendChild(el));
Â  }
Â  // â€”â€” SEARCH (with/without tags) â€”â€”
Â  else{
Â  Â  PUBS.forEach(p=>p.cards.filter(c=>{
Â  Â  Â  const tagOk = !hasFilter || c.tags?.some(t=>selTags.has(t));
Â  Â  Â  const txtOk = match((c.title + c.contentBlocks[0].content.join(' ')).toLowerCase());
Â  Â  Â  return !c.title.startsWith('ğŸ“–') && tagOk && txtOk;
Â  Â  }).forEach(c=>stack.push(pubCard(p,c,true))));

Â  Â  BOOKSARR.forEach(b=>{
Â  Â  Â  if((!hasFilter || selTags.has('ğŸ“š')) && match((b.title+b.text).toLowerCase())) stack.push(bookCard(b,true));
Â  Â  });
Â  Â  NOTESARR.forEach(n=>{
Â  Â  Â  if((!hasFilter || selTags.has(NOTE_TAG)) && match(n.title.toLowerCase())) stack.push(noteCard(n,true));
Â  Â  });
Â  Â  // Don't shuffle search results - keep them ordered by relevance
Â  Â  stack.forEach(el=>cv.appendChild(el));
Â  }

Â  // â€”â€” FALLBACK â€”â€”
Â  if(stack.length===0){
Â  Â  stack=[
Â  Â  Â  ...PUBS.flatMap(p=>p.cards.filter(c=>!c.title.startsWith('ğŸ“–')).map(c=>pubCard(p,c,false))),
Â  Â  Â  ...BOOKSARR.map(b=>bookCard(b,false)),
Â  Â  Â  ...NOTESARR.map(n=>noteCard(n,false))
Â  Â  ];
Â  Â  rnd(stack).forEach(el=>cv.appendChild(el));
Â  }

Â  // always scroll top after render
Â  cv.scrollTo(0,0);
}

loadData();
</script>
</body>
</html>
