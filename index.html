<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>futuro fortissimo â€“ explorer</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f6f9fe;--fg:#161616;--accent:#38bdf8;--gut:52px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;font-family:Inter,-apple-system,BlinkMacSystemFont,sans-serif;
          background:var(--bg);color:var(--fg);overflow:hidden}
a,button{background:none;border:none;color:inherit;font:inherit;cursor:pointer}
mark{background:var(--accent);color:#fff;border-radius:3px;padding:0 2px}

header{position:fixed;top:0;left:0;right:0;height:56px;display:flex;align-items:center;
       gap:.7rem;padding:0 5vw;background:var(--bg);z-index:10}
header img{height:28px}header h1{font-size:1.35rem;font-weight:700;font-style:italic}

/* top bar ----------------------------------------------------------- */
#topBar{margin-top:56px;padding:0 5vw;display:flex;align-items:center;gap:.7rem;z-index:5}
#search{flex:1;border-bottom:2px solid var(--fg);font-size:1.1rem;padding:.25rem .1rem;
        background:transparent;outline:none}
.pill{font-size:1.4rem;padding:.1rem .85rem;border-radius:9999px;user-select:none;
      transition:.15s}
.pill.active,.pill:hover{background:var(--accent);color:#fff}

/* gutter ----------------------------------------------------------- */
#gutter{position:fixed;right:0;top:56px;bottom:0;width:var(--gut);
        display:flex;flex-direction:column;align-items:center;gap:.5rem;
        overflow-y:auto;padding-top:.6rem}
#gutter .tag{font-size:1.35rem;border-radius:9999px;padding:.15rem;
             transition:.15s;cursor:pointer}
#gutter .tag.active,#gutter .tag:hover{background:var(--accent);color:#fff}

/* canvas ----------------------------------------------------------- */
#canvas{position:fixed;top:56px;left:0;right:var(--gut);bottom:0;
        overflow-y:auto;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch}
.page{min-height:calc(100vh - 56px);display:flex;align-items:center;justify-content:center;
      scroll-snap-align:start;padding:0 5vw}
.box{max-width:620px;width:100%;max-height:70vh;overflow-y:auto;padding:1.8rem 1.5rem}
.box::-webkit-scrollbar{display:none}
.box h2{font-size:1.35rem;font-weight:700;margin-bottom:.6rem}
.box h3{font-size:1.1rem;font-weight:700;margin:.3rem 0 .2rem}
.box p{line-height:1.5;margin-bottom:.6rem}
.box .src{font-size:.78rem;color:#555;margin-top:.3rem}

footer{position:fixed;bottom:0;left:0;right:0;height:50px;background:var(--bg);
       display:flex;justify-content:center;gap:1rem;align-items:center}
footer .cta{font-size:1.25rem;padding:.12rem 1.25rem;border-radius:9999px;cursor:pointer;
            transition:.15s}
footer .cta:hover{background:var(--accent);color:#fff}
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="logo">
  <h1>futuro&nbsp;fortissimo</h1>
</header>

<!-- search + macro-pill -->
<div id="topBar">
  <input id="search" placeholder="cerca / searchâ€¦">
  <div id="pBooks" class="pill" data-k="ðŸ“š">ðŸ“š</div>
  <div id="pNotes" class="pill" data-k="ðŸŽ¶">ðŸŽ¶</div>
</div>

<!-- emoji gutter -->
<div id="gutter"></div>

<!-- main viewport -->
<div id="canvas"></div>

<footer>
  <div class="cta" onclick="openNew('https://www.paypal.com/paypalme/michelemerelli')">â˜• sostieni</div>
  <div class="cta" onclick="openNew('https://linktr.ee/micmer')">ðŸ‘¤ chi&nbsp;sono</div>
</footer>

<script>
/* data PATH */
const SRC={it:'newsletter_data.json',en:'newsletter_data_en.json'},
      NOTES_PATH='notes.json',BOOKS_PATH='books.json';
/* state */
let LANG='it',PUBS,NOTES,BOOKS,q='',mainF=new Set(),tagF=new Set();
/* helpers */
const $=s=>document.querySelector(s),
      rnd=a=>a.sort(()=>Math.random()-.5),
      tagAll=['ðŸ’»','ðŸƒ','â¤ï¸','ðŸ’¸','âš½','ðŸ½','ðŸ§ ','ðŸ’Š','ðŸŽ¨','ðŸš•','ðŸ¥½','ðŸ‘¥','ðŸ’†'],
      hasTag=(t)=>tagF.size?t?.some(x=>tagF.has(x)):true,
      match=(t)=>t.toLowerCase().includes(q),
      hl=t=>q?t.replace(new RegExp(`(${q})`,'gi'),'<mark>$1</mark>'):t;
/* external */
const openNew=url=>window.open(url,'_blank');

/* build gutter */
const gut=$('#gutter');
tagAll.forEach(e=>{
  const n=document.createElement('div');n.textContent=e;n.className='tag';gut.appendChild(n);
  n.onclick=()=>{n.classList.toggle('active');tagF.has(e)?tagF.delete(e):tagF.add(e);render()}
});

/* top pills */
document.querySelectorAll('.pill').forEach(p=>p.onclick=()=>{const k=p.dataset.k;
  p.classList.toggle('active');mainF.has(k)?mainF.delete(k):mainF.add(k);render()});

/* search */
$('#search').oninput=e=>{q=e.target.value.trim().toLowerCase();render()};

/* load */
Promise.all([
  fetch(SRC[LANG]).then(r=>r.json()),
  fetch(NOTES_PATH).then(r=>r.json()),
  fetch(BOOKS_PATH).then(r=>r.json())
]).then(([d,n,b])=>{
  PUBS=rnd(d.publications);
  NOTES=rnd(n.notes);
  BOOKS=rnd(b);
  render();
});

/* render */
function render(){
  const C=$('#canvas');C.innerHTML='';
  let pages=[];

  /* search */
  if(q){
    PUBS.forEach(p=>p.cards.filter(c=>!c.title.startsWith('ðŸ“–')&&hasTag(c.tags)&&match(p.title+c.title+c.contentBlocks[0].content.join(' ')))
      .forEach(c=>pages.push(pubPage(p,c,false,true))));
    BOOKS.forEach(b=>{if(match(b.title+b.text))pages.push(bookPage(b,true))});
    NOTES.forEach(n=>{if(match(n.title+(n.description||'')))pages.push(notePage(n,true))});
    rnd(pages).forEach(p=>C.appendChild(p));return;
  }
  /* only books / only notes */
  if(mainF.has('ðŸ“š')&&!mainF.has('ðŸŽ¶')){rnd(BOOKS).forEach(b=>C.appendChild(bookPage(b,false)));return;}
  if(mainF.has('ðŸŽ¶')&&!mainF.has('ðŸ“š')){rnd(NOTES).forEach(n=>C.appendChild(notePage(n,false)));return;}
  /* tag filter */
  if(tagF.size){
    PUBS.forEach(p=>p.cards.filter(c=>!c.title.startsWith('ðŸ“–')&&hasTag(c.tags))
      .forEach(c=>pages.push(pubPage(p,c,false,false))));
    rnd(pages).forEach(p=>C.appendChild(p));return;
  }
  /* default home: 2 random of any type */
  const bag=[];
  PUBS.forEach(p=>p.cards.filter(c=>!c.title.startsWith('ðŸ“–')).forEach(c=>bag.push(pubPage(p,c,false,false))));
  BOOKS.forEach(b=>bag.push(bookPage(b,false)));
  NOTES.forEach(n=>bag.push(notePage(n,false)));
  rnd(bag).slice(0,2).forEach(p=>C.appendChild(p));
}

/* card builders */
function pubPage(pub,sub,showPub,highlight){
  const s=document.createElement('section');s.className='page';
  const b=document.createElement('div');b.className='box';s.appendChild(b);
  if(showPub) b.innerHTML+=`<h2>${hl(pub.title)}</h2>`;
  b.innerHTML+=`<h3>${highlight?hl(sub.title):sub.title}</h3>
    ${sub.contentBlocks[0].content.map(t=>`<p>${highlight?hl(t):t}</p>`).join('')}`;
  b.onclick=()=>openNew(pub.substackLink);
  return s;
}
function bookPage(o,highlight){
  const s=document.createElement('section');s.className='page';
  const b=document.createElement('div');b.className='box';s.appendChild(b);
  b.innerHTML=`<h2>${highlight?hl(o.title):o.title}</h2>
               <p>${highlight?hl(o.text):o.text}</p>
               <p class="src">${o.book} â€” ${o.author}</p>`;
  if(o.url) b.onclick=()=>openNew(o.url);
  return s;
}
function notePage(n,highlight){
  const s=document.createElement('section');s.className='page';
  const b=document.createElement('div');b.className='box';s.appendChild(b);
  const host=n.url?new URL(n.url).hostname.replace(/^www\./,''):'';
  b.innerHTML=`<h2>${highlight?hl(n.title):n.title}</h2>
               ${host?`<p class="src">${host}</p>`:''}`;
  if(n.url) b.onclick=()=>openNew(n.url);
  return s;
}
</script>
</body>
</html>